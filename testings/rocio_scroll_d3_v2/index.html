<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src = 'https://d3js.org/d3.v6.min.js'></script>
    <script src = 'https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script type="text/javascript" src="https://aesqe.github.io/mapboxgl-minimap/mapboxgl-control-minimap.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script src="./config.js"></script>
    
    <meta property='og:title' content='Catalonia: The land of touristic apartmentss'/>
    <meta property='og:image' content='https://github.com/cuthchow/college-majors-visualisation/blob/master/preview.png'/>
    <meta property='og:description' content='This interactive, scrollable data visualisation will take you on a journey through all of the different college majors in the United States, and compare how they stack up in terms of median graduate salary, gender ratios, employability, and other factors. '/>
    <meta property='og:url' content='https://cuthchow.github.io/college-majors-visualisation/'/>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
</head>


<body>
    <div id="graphic">
        <div id="sections">
             <section class="step"> <!-- cover -->                
                <div class="intro">
                    <div class="bg-video-wrap">
                        <video src="intro_ok.mp4" muted autoplay></video>
                    <div class="overlay"></div>
                        <h1>THE<br><span style="letter-spacing: 0.4em;">TWO</span><br>CAT</h1>
                        <h2>How <b>tourism</b> and <b>Airbnb</b> split <b>CATALONIA</b> into two different worlds</h2>
                    <div class="arrow"><img class="arrowImg" src="arrow.svg"></div>
                    </div> 
                </div>
            </section>
            <section class="step"> <!-- intro text -->                
                <div class="intro-slide">
                    <div class='intro-text-wrapper'>
                        <p>Coast or inland. Coca of fruit or coca of crackling. 'Charnego' or 'catalanet'. <b><u>Catalonia</u></b> is dual, also in tourism. 19.2 million tourists visited the Principality in 2018, and some stayed in one of the 73,857 apartments or rooms offered on Airbnb, the largest shared accommodation platform.
                        </p>
                        <p>Barcelona is not the only city that has seen this form of tourism spreads. <b><u>87%</u></b> of Catalan municipalities appear in this controversial network, while the rest live on the fringes. We analyze the presence of Airbnb <b><u>outside the capital</u></b>.
                        </p>
                    </div>
                </div>
            </section>
            <section class="step">                  
            </section>
            <section class="step"> 
                <div class="box">
                    <p>Of the 947 municipalities, <span style="background-color: #29DDC7"><b>87% have at least one Airbnb</b></span> listing. <b>The rest, 119, do not appear on the platform</b> (most belong to Terres de Lleida).</p>
                </div>  
            </section>
            <section class="step">
                <div class="box">
                    <p>At the tourist level, <b>Catalonia is divided into nine brands</b>: Barcelona, ​​Costa Barcelona, ​​Costa Brava, Costa Daurada, Paisatges de Barcelona, ​​Pirineus, Terres de l’Ebre, Terres de Lleida and Val d’Aran. <span style="background-color: #FFD208"><b>Costa Brava</b></span> is the one with the most locations with apartments on Airbnb.</p>
                </div>
            </section>
            <section class = 'step'>
                
            </section>
            <section class="step">
                <div class="box">
                    <p>Leaving aside Barcelona, ​​<span style="background-color: #29DDC7"><b>Salou</b></span>,  ​​<span style="background-color: #29DDC7"><b>Roses</b></span> and <span style="background-color: #29DDC7"><b>Lloret de Mar</b></span> are the three towns with the <b>highest number of accommodations on Airbnb</b>.
                    </p>
                </div>
            </section>
            <section class="step">
                <div class="box">
                    <p><span style="background-color: #29DDC7"><b>Naut Aran</b></span>, <span style="background-color: #29DDC7"><b>Begur</b></span> and <span style="background-color: #29DDC7"><b>Pals</b></span> are the ones with the <b>highest density of tourist apartments</b>, to their number of dwellings.</p>
                </div>
                 
            </section>
            <section class="step">
                <div class="box">
                    <p>Catalonia is a land of sun and beach for tourists: the coastline monopolizes the supply of shared accommodation — <span style="background-color: #FFD208"><b> Costa Brava</b></span> has the <b>highest rate of Airbnbs</b>. The Pyrenees follows, while in the West they are scarce.
                    </p>
                </div>
            </section>
            <section class="step">
                <div class="box">
                    <p><b>How is the Airbnb catalogue distributed in Catalonia?</b> We fly over the Principality to observe closely in which areas of the hottest points the offer is concentrated and what the non-existent municipalities are like for the platform.</p>
                </div>
            </section>
            <section class='step'>
                <div class="box">
                <p>Naut Aran, a group of towns made up of Arties, Bagergue, Baqueira, Garòs, Gessa, Montgarri, Salardú, Tredòs and Unha, accounts for the <b>highest percentage of Airbnb in all of Catalonia: 66%</b></p>
                <p>Airbnb has been a source of complaints and legal discussions in Barcelona, where the City Council's attempts to legalize tourist accommodation have not fully borne fruit. The platform is accused of promoting gentrification and raising the price of rents, as well as being a nightmare for some residents. <b>In Barcelona, Airbnb's offer is concentrated in the districts of Ciutat Vella, l’Eixample and Gràcia.</b></p>
                </div>
            </section>
            <section class='step'>
                <!-- <div class="intro-slide">
                    <div class='intro-text-wrapper'>
                    </div>
                </div> -->
            </section>
            <section class="step" id="stepMapBox"> <!-- map box -->
             <div id="map"></div>
             <div id="story"></div> 
            </section>
            <section class="step" id="stepEx1"> <!-- extra1 -->                
            </section>
            <section class="step"> <!-- extra2 -->                
            </section>
            <section class="step"> <!-- extra3 -->                
            </section>
            <section class="step"> <!-- extra4 -->                
            </section>
            <section class="step"> <!-- extra5 -->                
            </section>
            <section class="step"> <!-- extra6 -->                
            </section>
            <section class="step"> <!-- extra7 -->                
            </section>
            <section class="step"> <!-- extra8 -->                
            </section>
            <section class="step"> <!-- extra9 -->      
            </section>
            <section class="step"> <!-- conclusions --> 
                <div class="finaltext">
                    <p class="subtitle">CONCLUSIONS</p>
                    <p>The coast, and especially Costa Brava, is the biggest claim for those who choose Catalonia as a place of recreation. The interior, especially the West, is uninteresting. Why? Apart from the tourist attractions of each place (cultural or natural), the data analyzed does not provide a clear answer, beyond the sun and the beach.</p>
                    <p><i>Does Airbnb help people with low incomes? Does it contribute to gentrifying neighbourhoods and raising the price of rents?</i> Or is it a way of travelling and getting to know the destination better? The heads and tails with which it is associated with the platform do not have a firm conclusion when looking at the entire territory and not just the capital.</p>
                    <p>The beach towel seems to unite the most attractive municipalities while ageing towns appear among the absent ones. Els Omellons, Bovera, La Palma d'Ebre, El Cogul and Algerri, five of the ten Catalan towns with the highest percentage of people over 65 years of age (between 37% and 39% of its population), do not appear on Airbnb. Two of them, Els Omellons and Bovera, do not have any type of tourist accommodation.</p>
                    <p>Depopulation is also part of the non-tourist Catalonia. La Febró and Fígols, two of the ten towns with the fewest inhabitants (40 and 43 people, respectively), are not on Airbnb either. And among the previous five aged, the sum of its population does not reach 1,400 people.
                    </p>
                    <p><b>A great tourist Catalonia and a small Catalonia without visitors.</b> This is the main result of this work, which opens up ways to continue exploring the arguments of both parties.
                    </p>
                </div>  
                <br>
                </div> 
            </section>

            <section class="step"> <!-- Methodology --> 
            <div class="finaltext">
                    <p class="subtitle">METHODOLOGY</p>
                        <p>The data is the basis and the starting point of this work. And the data has been one of the headaches, because they do not exist or because they are incomplete. Airbnb does not facilitate access to its catalog: you have to resort to scraping or, as we have done, to other projects that have opened this data. In our case the main source of information has been DataHippo. And we have focused on the Airbnb offering, as it is the largest shared hosting platform. </p>
                        <p>We started with <b>the data</b> on tourist apartments offered by the National Institute of Statistics (INE), but when we found that they were clearly insufficient, we discarded them. This institution only collects the apartments that are officially registered: when comparing them with those of DataHippo, which offers a real photograph of the number of accommodations, we saw that it did not fit.</p>
                        <p>DataHippo's loyalty, however, has a weak point: it only portrays 2018. And the INE, only 2020 and 2021. We are left without the possibility of observing how this phenomenon has developed in Catalonia, how it has evolved and what its effects have been growth phases.</p>
                        <p>After cleaning the data to avoid possible duplications (we were left with the geolocated apartments more than 10 meters apart), we chose the variables that we think could be related to the expansion of Airbnb.</p>
                        <p>There are studies and articles that affirm that the proliferation of tourist apartments promotes gentrification and increases the price of rents in general (in large cities): we analyze the price relationship of rental apartments in Catalonia between 2015 and 2020 (data from the INE ) with the Airbnb number in each of the 947 Catalan municipalities: <b>we do not see a correlation.</b></p>
                        <p>We calculate the percentage of Airbnb accommodations over the total number of homes in each location, to see if there are populations colonized by the platform, as The Guardian did. But the Institut d'Estadística de Catalunya (Idescat, from which we obtained these data) doesn’t collect information for all the municipalities. Despite not obtaining the complete sample, we take advantage of the results to have an approximation of the municipalities with the greatest weight of Airbnb.</p>
                        <p>We also analyze the relationship between tourist apartments and the percentage of foreigners, the percentage of people over 65 years of age and the population as a whole in each locality (with data from the INE and Idescat): some correlation in each case, but of little plot weight.</p>
                        <p>Finally, we have identified the owners of tourist apartments in each municipality, but we have not been able to calculate the price range, since only half of the data exists (and the results are not reliable).</p>
                    </div>
                </section>

            <section class="step"> <!-- Footer --> 
                <div class="footer">
                    <p class="subtitle">THE PROJECT</p>
                </div> 
            </section>
        </div>
        <div id="vis-container">
        <div id="vis"></div></div>
        </div>
    </div>


    <script>
    var layerTypes = {
        'fill': ['fill-opacity'],
        'line': ['line-opacity'],
        'circle': ['circle-opacity', 'circle-stroke-opacity'],
        'symbol': ['icon-opacity', 'text-opacity'],
        'raster': ['raster-opacity'],
        'fill-extrusion': ['fill-extrusion-opacity']
    }
    
    var alignments = {
        'left': 'lefty',
        'center': 'centered',
        'right': 'righty'
    }
    
    function getLayerPaintType(layer) {
        var layerType = map.getLayer(layer).type;
        return layerTypes[layerType];
    }
    
    function setLayerOpacity(layer) {
        var paintProps = getLayerPaintType(layer.layer);
        paintProps.forEach(function(prop) {
            map.setPaintProperty(layer.layer, prop, layer.opacity);
        });
    }
    
    var story = document.getElementById('story');
    var features = document.createElement('div');
    features.classList.add(alignments[config.alignment]);
    features.setAttribute('id', 'features');
    
    var header = document.createElement('div');
    
    if (config.title) {
        var titleText = document.createElement('h1');
        titleText.innerText = config.title;
        header.appendChild(titleText);
    }
    
    if (config.subtitle) {
        var subtitleText = document.createElement('h2');
        subtitleText.innerText = config.subtitle;
        header.appendChild(subtitleText);
    }
    
    if (config.byline) {
        var bylineText = document.createElement('p');
        bylineText.innerText = config.byline;
        header.appendChild(bylineText);
    }
    
    if (header.innerText.length > 0) {
        header.classList.add(config.theme);
        header.setAttribute('id', 'header');
        story.appendChild(header);
    }
    
    config.chapters.forEach((record, idx) => {
        var container = document.createElement('div');
        var chapter = document.createElement('div');
        
        if (record.title) {
            var title = document.createElement('h3');
            title.innerText = record.title;
            chapter.appendChild(title);
        }
        
        if (record.image) {
            var image = new Image();  
            image.src = record.image;  
            chapter.appendChild(image);
        }
        
        if (record.description) {
            var story = document.createElement('p');
            story.innerHTML = record.description;
            chapter.appendChild(story);
        }
    
        container.setAttribute('id', record.id);
        container.classList.add('step1');
        if (idx === 0) {
            container.classList.add('active');
        }
    
        chapter.classList.add(config.theme);
        container.appendChild(chapter);
        features.appendChild(container);
    });
    
    story.appendChild(features);
    
    var footer = document.createElement('div');
    
    if (config.footer) {
        var footerText = document.createElement('p');
        footerText.innerHTML = config.footer;
        footer.appendChild(footerText);
    }
    
    if (footer.innerText.length > 0) {
        footer.classList.add(config.theme);
        footer.setAttribute('id', 'footer');
        story.appendChild(footer);
    }
    
    mapboxgl.accessToken = config.accessToken;
    
    const transformRequest = (url) => {
        const hasQuery = url.indexOf("?") !== -1;	  
        const suffix = hasQuery ? "&pluginName=journalismScrollytelling" : "?pluginName=journalismScrollytelling";	  
        return {
          url: url + suffix
        }	  
    }
    
    var map = new mapboxgl.Map({
        container: 'map',
        style: config.style,
        center: config.chapters[0].location.center,
        zoom: config.chapters[0].location.zoom,
        bearing: config.chapters[0].location.bearing,
        pitch: config.chapters[0].location.pitch,
        scrollZoom: false,
        attributionControl: true,
        transformRequest: transformRequest
    });
    
    var marker = new mapboxgl.Marker();
    if (config.showMarkers) {
        marker.setLngLat(config.chapters[0].location.center).addTo(map);
    }
    
    // instantiate the scrollama
    var scroller1 = scrollama();
    
    map.on("load", function() {
        map.addSource("airbnb", {
        type: 'vector',
        url: 'mapbox://laurarago.2plwqw2z',
        });
    
        map.addSource("Municipalities", {
        type: 'vector',
        url: 'mapbox://laurarago.8vqorl0k',
        });
    
    
    
    
    var hoveredStateId =  null;
    var searched_lngLat = null;
    
        map.addLayer({
            'id': 'airbnb-fill',
            'type': 'circle',
            'source': 'airbnb',
            'source-layer': 'AirbnbData',
            'paint': {
            // make circles larger as the user zooms from z12 to z22
            'circle-radius': {
                'base': 1.75,
                'stops': [
                    [9, 2],
                    [10, 4],
                    [15, 7]
                ]
                },
            'circle-color': '#29DDC7',
            'circle-opacity': 0.7,
            'circle-stroke-color': ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
            'circle-stroke-width': ["case", ["boolean", ["feature-state", "hover"], false], 2, 0]}
        }, "settlement-subdivision-label");
    
        map.addLayer({
            'id': 'airbnb-brand',
            'type': 'circle',
            'source': 'airbnb',
            'source-layer': 'AirbnbData',
            'paint': {
                // make circles larger as the user zooms from z12 to z22
                'circle-radius': {
                    'base': 1.75,
                    'stops': [
                        [9, 2],
                        [10, 4],
                        [15, 7]
                    ]
                },
            'circle-color': ["match", ["get","RealData_brand"], "Costa Brava", "#FFD208", "#29DDC7"],
            'circle-opacity': 0,
            'circle-stroke-color': ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
            'circle-stroke-width': ["case", ["boolean", ["feature-state", "hover"], false], 2, 0]}
        }, "settlement-subdivision-label");
    
        map.addLayer({
            'id': 'Roses',
            'type': 'line',
            'renderingMode': '2d',
            'source': 'Municipalities',
            'source-layer': 'Municipalities',
            'filter': ['in', "cap_muni", "Roses"],
            'paint': {
            "line-color": "#333333",
            "line-width": 4,
            "line-opacity": 0
            
            }
                }, "settlement-subdivision-label");
    
                map.addLayer({
            'id': 'Begur',
            'type': 'line',
            'renderingMode': '2d',
            'source': 'Municipalities',
            'source-layer': 'Municipalities',
            'filter': ['in', "cap_muni", "Begur"],
            'paint': {
            "line-color": "#333333",
            "line-width": 4,
            "line-opacity": 0
            
            }
                }, "settlement-subdivision-label");

                map.addLayer({
            'id': 'NautAran',
            'type': 'line',
            'renderingMode': '2d',
            'source': 'Municipalities',
            'source-layer': 'Municipalities',
            'filter': ['in', "codiine", "25025"],
            'paint': {
            "line-color": "#333333",
            "line-width": 4,
            "line-opacity": 0
            
            }
                }, "settlement-subdivision-label");

                map.addLayer({
            'id': 'Alamus',
            'type': 'line',
            'renderingMode': '2d',
            'source': 'Municipalities',
            'source-layer': 'Municipalities',
            'filter': ['in', "codiine", "25004"],
            'paint': {
            "line-color": "#333333",
            "line-width": 4,
            "line-opacity": 0
            
            }
                }, "settlement-subdivision-label");
    
    
    map.addControl(new mapboxgl.Minimap({
        id: "mapboxgl-minimap",
        width: "25vh",
        height: "25vh",
        style: "mapbox://styles/laurarago/ckq1iuxap0wkk17p96m3vsgkj",
        lineColor: "#29DDC7",
        lineWidth: 1,
        lineOpacity: 1,
        fillColor: "#29DDC7",
        fillOpacity: 0.25,
        center: { lon: 1.61177, lat: 41.70028 },
            zoom: 4.7,
                zoomLevels: []
            }), 'bottom-right');
    
        // setup the instance, pass callback functions
        scroller1
        .setup({
            step: '.step1',
            offset: 0.5,
            progress: true
        })
        .onStepEnter(response => {
            var chapter = config.chapters.find(chap => chap.id === response.element.id);
            response.element.classList.add('active');
            map.flyTo(chapter.location);
            if (config.showMarkers) {
                marker.setLngLat(chapter.location.center);
            }
            if (chapter.onChapterEnter.length > 0) {
                chapter.onChapterEnter.forEach(setLayerOpacity);
            }
        })
        .onStepExit(response => {
            var chapter = config.chapters.find(chap => chap.id === response.element.id);
            response.element.classList.remove('active');
            if (chapter.onChapterExit.length > 0) {
                chapter.onChapterExit.forEach(setLayerOpacity);
            }
        });
    });
    
    // setup resize event
    window.addEventListener('resize', scroller1.resize);
    
    </script>
    <script src = 'scroller.js'></script>
    <script src = 'sections.js'></script>
</body>
</html>
